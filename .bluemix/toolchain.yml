version: '2'

template:
  name: "DYML_SECRETS_VIA_ENV_ENGINE"
  description: "DYML_SECRETS_VIA_ENV_ENGINE"
  required:
    - build
    - repo

  info:
    git url: >
      "[" + $env.repository + "]" +
        "(" + $env.repository + ")"
    git branch: >
      "[" + $env.branch + "]" +
        "(" + $env.repository +
          "/tree/" + $env.branch + ")"

toolchain:
  name: 'DYML_SECRETS_VIA_ENV_ENGINE'

  $configuration:
    #EVALUATION_DEPTH: 10
    #EVALUATE_TIMESTAMP_SERVERSIDE: true
    BASIC_WARNINGS: false
    #EXPRESSION_MAXLENGTH: 200
    ENABLE_EXTENSIONS: true
    ENABLE_SECRET_EXPANSION: true

services:
  repo:
    service_id: hostedgit
    parameters:
      test1: >
        $env.getSecret("kms:us-south:default:acme_kms_store:acme_git_password")
      test2: $env.timestamp

form:
  pipeline:
    parameters:
      username: 'admin'
      group: 'system'
    schema:
      $ref: deploy.json
