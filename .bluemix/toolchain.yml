version: '2'

template:
  name: "DYML: $switch/$case construct"
  description: "DYML: $switch/$case construct"
  required:
    - build
    - frontend-repo
    - sample-repo

  # [ type: complex/inline ] -> evaluated in the $env js engine
  #
  info:
    git url: >-
      $env.repository ? '[' + $env.repository + '](' + $env.repository + ')' : "[https://github.com/tonymcguckin/dynamicyml](https://github.com/tonymcguckin/dynamicyml)"
    git branch: >-
      $env.repository && $env.branch ? '[' + $env.branch + ']('+ $env.repository + '/tree/' + $env.branch + ')': "[flavour9](https://github.com/tonymcguckin/dynamicyml/tree/flavour9)"

toolchain:
  name: 'DYML: $switch/$case construct'

services:

  # dynamic yml 'service' entry...
  frontend-repo:
    
    $switch:
      
      # $expr can be a unary/binary/ternary/complex, static string, or {{mustache}}
      #
      - $expr: $env.expr

      #- $expr: hostedgit
      #- $expr: 'hostedgit'
      #- $expr: "hostedgit"
      
      #- $expr: {{expr}}
      #- $expr: '{{expr}}'
      #- $expr: "{{expr}}"
 
      - $default: 'hostedgit'
        service_id: 'hostedgit'
        parameters:

          # [ type: unary ] -> translates to {{test}}
          # will raise a warning if 'test' cannot be resolved
          #
          test1: $env.test
 
          # [ type: binary ] -> LHS translates to {{test}} if resolved
          # and will raise a warning if 'test' cannot be resolved
          # RHS will be used if LHS didn't resolve
          #
          test2: $env.test || test2
          test3: "$env.test || {{test3}}"
 
          # [ type: ternary js ] -> evaluated in $env expression engine
          #
          test4: "$env.test !== undefined ? 'test6_true' : $env.branch"
          
          # [ type: complex js ] -> evaluated in $env expression engine
          #
          test5: "$env.test || 'test' + '5'"
          test6: "$env.test || $env.expr || $env.tenant"
          
          test7: "$env.env_id + ' test7 with parenthesis inside a quoted string () so it's safe'"
          test8: "$env.env_id + ' test8 trying to invoke a method: ' + Date.now() + ' which is restricted'"
          test9: "$env.env_id + ' test9 with a mix of quoted and method invocation (): ' + Date.now() + ' which is restricted'"
          test10: "$env.u != undefined ? $env.u : '' + \\u0065\\u0076\\u0061\\u006C('10 + 10')"
          test11: "$env.u != undefined ? $env.u : '' + \\u0065\\u0076\\u0061\\u006C"
          
          # [ type: complex js ] -> invalid as mustache {{test3}}
          # won't resolve on the server-side
          #
          test12: "{{test3}} || $env.app_repo"
          
          # [ type: regular js ] ignored by the $env expression engine
          #
          test13: "eval('process.exit(0)');"
          test14: "javascript:Date.now()"
          

form:
  pipeline:
    parameters: {}
    schema: {}
