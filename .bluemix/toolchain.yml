version: '2'

template:
  name: "DYML: $switch/$case construct"
  description: "DYML: $switch/$case construct"
  required:
    - sample-repo
  info:
    git url: >-
      [https://github.com/tonymcguckin/dynamicyml](https://github.com/tonymcguckin/dynamicyml)
    git branch: >-
      [master](https://github.com/tonymcguckin/dynamicyml/tree/master)

toolchain:
  name: 'DYML: $switch/$case construct'

services:

  # dynamic yml 'service' entry...
  sample-repo:

    $switch:

      - $expr: $env.case

      - $defaultddd: 'hostedgit'
        service_id: hostedgit
        parameters:
          repo_name: 'BYOC MyApp'
          repo_url: $env.app_repo || 'http://blah.com/repo'
          type: $env.type || "link"
          has_issues: $env.issues || true
          enable_traceability: $env.trace || true
  
      - $case: 'githubpublic'
        service_id: githubpublic
        parameters:
          repo_name: 'BYOC MyApp'
          repo_url: '{{app_repo}}'
          #type: "$env.type || 'link'"
          type: "$env.type || {{type}}"
          #has_issues: $env.issues || true
          #enable_traceability: $env.trace || true

      - $case: 'github_integrated'
        service_id: github_integrated
        parameters:
          repo_name: 'BYOC MyApp'
          repo_url: '{{app_repo}}'
          type: $env.type || "link"
          has_issues: $env.issues || true
          enable_traceability: $env.trace || true
form:
  pipeline:
    parameters:
      username: 'admin'
      group: 'system'
    schema:
      $ref: deploy.json
