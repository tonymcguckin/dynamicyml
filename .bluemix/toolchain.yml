version: '2'

template:

  name: "DYML: $switch/$case construct"

  description: "DYML: $switch/$case construct"
  required:
    - build
    - frontend-repo
    - sample-repo

  info:
    git url: >-
      $env.repository ? '[' + $env.repository + '](' + $env.repository + ')' : "[https://github.com/open-toolchain/simple-toolchain-hosted](https://github.com/open-toolchain/simple-toolchain-hosted)"
    git branch: >-
      $env.repository && $env.branch ? '[' + $env.branch + ']('+ $env.repository + '/tree/master)': "[master](https://github.com/open-toolchain/simple-toolchain-hosted/tree/master)"

toolchain:
  name: 'DYML: $switch/$case construct'

services:

  # dynamic yml 'service' entry...
  sample-repo:

    $switch:

      #- $expr: $env.expr
      #- $expr: github
      #- $expr: 'github'
      #- $expr: "github"
      
      #- $expr: {{expr}}
      #- $expr: '{{expr}}'
      - $expr: "{{expr}}"
  
      - $case: "bitbucket"
        service_id: bitbucket
        parameters: {}
  
      - $case: "github"
        service_id: github
        parameters:
          test: "$env.foo ? $env.foo : $env.branch"
  
      - $default: "gitlab"
        service_id: gitlab
        parameters: {}

form:
  pipeline:
    parameters:
      username: 'admin'
      group: 'system'
    schema:
      $ref: deploy.json
