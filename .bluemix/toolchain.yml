version: '2'

template:

  # dyml name property with value determined by dyml $if construct...
  name:
  
    - $if: "$env.i == 1"
      $result: 
        a: a
        b: {}
        c: 
          - 
            c: "1"
          - 
            c: "2"
        d: 
          d1: d1
          d2: d2
        e: 1
        f: 0
        g: true
        h: false
        i: 99
        j: 88.77

    - $elseif: "$env.i == 2"
      $result: "DYML: $switch/$case construct 2"
      
    - $elseif: "$env.i == 3"
      $result: "DYML: $switch/$case construct 3"
      
    - $elseif: "$env.i == 4"
      $result: "DYML: $switch/$case construct 4"
      
    - $elseif: "$env.i == 4"
      $result: "DYML: $switch/$case construct 5"
      
    - $else:
      $result: "DYML: $switch/$case construct (else)"

  description: "DYML: $switch/$case construct"
  required:
    - build
    - frontend-repo
    - sample-repo
  info:
    git url: >-
      [https://github.com/tonymcguckin/dynamicyml](https://github.com/tonymcguckin/dynamicyml)
    git branch: >-
      [master](https://github.com/tonymcguckin/dynamicyml/tree/master)

toolchain:
  name: 'DYML: $switch/$case construct'

services:

  # dynamic yml 'service' entry...
  sample-repo:

    $switch:

      - $expr: $env.source_provider
  
      - $default: false
      
      - my_custom_entry: {}

      - $case: true
        service_id: hostedgit
        parameters:
          repo_name: 'BYOC MyApp'
          repo_url: $env.app_repo || 'http://blah.com/repo'
          type1: $env.type1 || "fo'rk'eee"
          type2: $env.type2 || 'fo'rk'e'
          foo: $env.foo == 'foo' ? 'bar' || 'http://blah.com/repo'
          type: $env.type || 'clone'
          foo1: $env.foo
          visibility: public
  
      - $case: 'githubpublic'
        service_id: githubpublic
        parameters:
          repo_name: 'BYOC MyApp'
          repo_url: $env.app_repo || 'http://blah.com/repo'
          type: $env.type || 'link'
          visibility: public

      - $case: 'github_integrated'
        service_id: github_integrated
        parameters:
          repo_name: 'BYOC MyApp'
          repo_url: '{{app_repo}}'
          type: 'link'
          has_issues: true
          enable_traceability: true
          
      - my_other_custom_entry: true

form:
  pipeline:
    parameters:
      username: 'admin'
      group: 'system'
    schema:
      $ref: deploy.json
