version: '2'

template:
  name: "SECRETS_VIA_ENV_ENGINE"
  description: "SECRETS_VIA_ENV_ENGINE"
  required:
    - repo

  info:
    git url: >
      '[' + $env.repository + '](' + $env.repository + ')'
    git branch: >
      '[' + $env.branch + ']('+ $env.repository + '/tree/' + $env.branch + ')'

  $configuration:
    BASIC_WARNINGS: false
    ENABLE_EXTENSIONS: true
    ENABLE_SECRET_EXPANSION: true

toolchain:
  name: 'SECRETS_VIA_ENV_ENGINE'

services:
  repo:
    service_id: hostedgit
    parameters:
      test1: >
        $env.getSecret("kms:us-south:default:tmg-kp-1:tmg-common-service-id-apikey")
      test2: $env.timestamp
      test4: $env.branch
      test5: >
        $ibmcloud.secret("kms:us-south:default:tmg-kp-1:tmg-common-service-id-apikey")

form:
  pipeline:
    parameters:
      username: 'admin'
      group: 'system'
    schema:
      $ref: deploy.json
